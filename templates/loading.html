<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Scanning in Progress...</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap"
      rel="stylesheet"
    />
  </head>

  <body class="cyber-bg">
    <canvas id="matrix"></canvas>
    <div class="cyber-overlay">
      <div class="card cyber-card text-center p-5" style="max-width: 500px">
        <h2 class="cyber-title mb-3">üîç Scanning URL</h2>
        <p class="cyber-subtext mb-4">
          Analyzing site reputation, domain age, HTTPS validity, and more...
        </p>

        <div class="scanner-bar mx-auto mb-4">
          <div class="scanner-progress"></div>
        </div>

        <p class="scan-status">Please wait while we scan the link...</p>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("matrix");
      const ctx = canvas.getContext("2d");
      canvas.height = window.innerHeight;
      canvas.width = window.innerWidth;
      const chars = "01";
      const fontSize = 16;
      const columns = canvas.width / fontSize;
      const drops = Array(Math.floor(columns)).fill(1);

      function draw() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#00ffff";
        ctx.font = fontSize + "px monospace";
        for (let i = 0; i < drops.length; i++) {
          const text = chars.charAt(Math.floor(Math.random() * chars.length));
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975)
            drops[i] = 0;
          drops[i]++;
        }
      }
      setInterval(draw, 33);

      // Redirect after scan
      setTimeout(() => {
        const form = document.createElement("form");
        form.method = "POST";
        form.action = "/scan";
        const input = document.createElement("input");
        input.type = "hidden";
        input.name = "url";
        input.value = "{{ url }}";
        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
      }, 3500);
    </script>
  </body>
</html>
